const e="debug",t="info",s="table",r="warn",o="error";class a{#e;#t;#s;constructor(e,t,s){this.#e=e,this.#t=t,this.#s=s}#r=(e,t,s="",r)=>{const o={name:this.#e,tag:this.#t,level:e,type:t,ts:Date.now()/1e3,message:s,metadata:r};for(const e of this.#s)e(o)};debug=(t,...s)=>this.#r(20,e,t,s);info=(e,...s)=>this.#r(30,t,e,s);table=(e,...t)=>this.#r(30,s,void 0,[e,...t]);warn=(e,...t)=>this.#r(40,r,e,t);error=(e,...t)=>this.#r(50,o,e,t);tag=e=>new a(this.#e,e,this.#s)}class n{error;value;constructor(e,t){this.value=e,this.error=t}static value(e){return new n(e,void 0)}static error(e){return new n(void 0,e)}static tryCatch(e){try{return n.value(e())}catch(e){return n.error(e)}}get isError(){return!!this.error}get isSuccess(){return!this.error}onError=e=>(this.isError&&e(this.error),this);or=e=>this.isError?e:this.value;get=()=>{if(this.isError)throw this.error;return this.value}}const i=e=>e?e.split("&").reduce(((e,t)=>{try{const[s,r]=t.split("=").map(decodeURIComponent);s&&(e[s]=r)}catch{}return e}),{}):{},c=()=>n.tryCatch((()=>i(location.hash.replace(/^#/,"")))).value??{},d=n.tryCatch((()=>i(location.search.replace(/^\?/,"")))).value??{};let h=c();addEventListener("hashchange",(()=>{h=c()}));const l=e=>null===e,u=e=>"boolean"==typeof e,g=e=>"number"==typeof e&&!isNaN(e),p=e=>"string"==typeof e,m=e=>"function"==typeof e,f=e=>"object"==typeof e&&!(e=>Array.isArray(e))(e)&&!l(e),b=(e,t)=>{const s=h,r=`hbv-${e}`;return Object.prototype.hasOwnProperty.call(s,r)?{found:!0,value:t(s[r]??"")}:{found:!1}},v=(e,t)=>{const s=((e,t)=>{try{return((e,t)=>e.getItem(t))(localStorage,t)}catch(e){return null}})(0,`hbv:${e}`);return l(s)?{found:!1}:{found:!0,value:t(s)}},w=e=>{const t=e=>""===e||(e=>!!["yes","true","1"].some((t=>0===t.localeCompare(e,void 0,{sensitivity:"accent"})))||!["no","false","0"].some((t=>0===t.localeCompare(e,void 0,{sensitivity:"accent"})))&&void 0)(e),s=e=>{const s=t(e);if((e=>!(e=>l(e)||(e=>void 0===e)(e))(e))(s))return!s};return((...e)=>{for(const t of e){const{found:e,value:s}=t();if(e)return s}})((()=>b(e,t)),(()=>b(`no-${e}`,s)),(()=>v(e,t)),(()=>v(`no-${e}`,s)))},y=(["prv","beta"].reduce(((e,t)=>w(t)??e),void 0),["prv","peek","gravity"].reduce(((e,t)=>w(t)??e),void 0)??!1),$={[e]:"#9C27B0",[t]:"#4CAF50",[r]:"#FF9800",[o]:"#F44336"},x=t=>{if(t.type===s&&console.table)console.table(...t.metadata);else{const s=(({type:e,name:t,tag:s})=>{const r=(e=>{if(!e)return"#607D8B";const t=Math.PI;return`hsl(${(e=>{let t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t|=0;return t})(e)*t%360}, 70%, 53%)`})(s);return{text:`%c${t}%c${e}%c${s}`,arguments:["background: linear-gradient(#4D4D4D, #5D5D5D); color: #fff; padding: 2px 4px; border-top-left-radius: 4px; border-bottom-left-radius: 4px;",`background: ${$[e]??"#000"}; color: #fff; padding: 2px 4px;`,`background: ${r}; color: #fff; padding: 2px 2px; border-top-right-radius: 4px; border-bottom-right-radius: 4px;`]}})({type:t.type,name:t.name,tag:t.tag});t.type===e?console.debug(s.text,...s.arguments,t.message,...t.metadata):console.log(s.text,...s.arguments,t.message,...t.metadata)}},F=e=>{let t;return(...s)=>(t??=n.tryCatch((()=>e(...s))),t.get())};class I{#o;provide=F((e=>{this.#o=e}));get value(){return this.#o}}const E=(new I).value,M=new a("HUBVISOR","wrapper",(()=>{const e=[];return E&&e.push(E),y&&e.push(x),e})());class k{#r;items={};constructor(e){this.#r=M.tag(`Collection<${e}>`)}add=(e,t)=>{this.items[e]&&this.#r.warn(`A module was already registered for '${e}', the previous one will be discarded`),this.items[e]=t,this.#r.debug(`Item '${e}' was successfully added`)};list=()=>Object.entries(this.items).reduce(((e,[t,s])=>(s&&e.push({name:t,value:s}),e)),[]);get=e=>this.items[e]}new class{registrations={};#r;#a;constructor(e){this.#r=M.tag(`Registry<${e}>`)}register=(e,t)=>{this.registrations[e]&&this.#r.warn(`A module was already registered for '${e}', the previous one will be discarded`),this.registrations[e]=t,this.#r.debug(`Module '${e}' was successfully registered`),this.#n(e)};#n=e=>{if(!this.#a)return;const t=this.registrations[e];if(!t)return this.#r.warn(`couldn't start module '${e}' because it wasn't registered`);try{t.start?.(this.#a.options),this.#r.debug(`Module '${e}' was started successfully`)}catch(t){this.#r.error(`Error starting module '${e}'`,this.#a.options,t)}};start=e=>{if(this.#a)return this.#r.warn("start was called more than once: ignored",e);this.#a={options:e};for(const e of Object.keys(this.registrations))this.#n(e)}}("Renderers");const C=new I,D=(new I,new k("prebid-bid-formatters"),new k("bid-iab-vendorids"),new k("content-providers"),new Set,new I,new I,(e,t,s)=>{const r=e.getElementById(t)??((e,t)=>{const s=e.createElement("style");return s.id=t,e.head.append(s),s})(e,t);return(e=>{for(;e.firstChild;)e.firstChild.remove()})(r),r.append(document.createTextNode(s)),r}),O=(F(D),(e,{id:t,width:s,height:r})=>{t&&(e.id=t),((e,t)=>{for(const[s,r]of Object.entries(t)){const t=r.replace(/\s*!important\s*$/gi,""),o=r!==t;e.style.setProperty(s,t,o?"important":"")}})(e,{width:`${s}px`,height:`${r}px`,border:"0"});const o={marginheight:"0",marginwidth:"0",width:`${s}`,height:`${r}`,topmargin:"0",leftmargin:"0",allowtransparency:"true",scrolling:"no"};for(const[t,s]of Object.entries(o))e.setAttribute(t,s)}),S=(/Firefox\//i.test(navigator.userAgent),1011);class A extends Error{code;source;constructor(e,t,s){s?super(s):t instanceof Error?super(t.message):super(t),this.code=e,t instanceof Error&&(this.source=t),m(Error.captureStackTrace)?Error.captureStackTrace(this,this.constructor):this.stack=new Error(s).stack}}const{error:N}=M.tag("Formats"),P=async(e,t,s="about:blank")=>{const r=e.createElement("iframe");r.src=s,r.style.overflow="hidden",r.style.display="inline",O(r,{width:t.width,height:t.height});const o=(()=>{let e,t;return{promise:new Promise(((s,r)=>{e=s,t=r})),resolve:e,reject:t}})();if(r.onload=()=>{o.resolve()},e.body.append(r),await o.promise,!r.contentDocument)throw new A(S,`iframe contentDocument not found: this should not happen (${t.bidder} on ${t.placementId})`);return r.contentDocument},{error:j}=M.tag("bus");class T{#i={};clear=()=>{this.#i={}};#c=(e,t)=>{this.#i[e]||(this.#i[e]=[]),this.#i[e]?.push(t)};on=(e,t)=>{this.#c(e,{listener:t,original:t})};off=(e,t)=>{this.#i[e]=this.#i[e]?.filter((e=>e.original!==t))};once=(e,t)=>{this.#c(e,{listener:(e,s)=>{t(e,s),this.off(s,t)},original:t})};dispatch=(e,t)=>{for(const s of this.#i[e]??[])try{s.listener(t,e)}catch(s){j(`listener registration failed for event '${String(e)}'`,t,s)}}}const{debug:B}=M.tag("channel");class H{#d=new T;#h;constructor(e){const{source:t,...s}=e;this.#h={...s},this.open(t??window)}close=()=>{this.#h.source&&(this.#d.clear(),this.#h.source.removeEventListener("message",this.#l),this.#h.source=void 0,B(`'${this.#h.name}' closed`))};open=e=>{this.close(),this.#h.source=e,this.#h.source.addEventListener("message",this.#l),B(`'${this.#h.name}' channel opened with namespace '${this.#h.namespace}'`)};#u=e=>{const[t,s]=e;if(!p(t))return!1;const r=this.#h.validators[t];return!!r?.(s)};#g=e=>{try{return JSON.parse(e)}catch{}};#l=e=>{try{if(e.source!==this.#h.target)return;if(!p(e.data))return;const t=this.#g(e.data);if(!t)return;const{event:s,params:r,ns:o}=t;if(o!==this.#h.namespace)return;if(!this.#u([s,r]))throw new Error("couldn't validate message data");B(`'${this.#h.name}' received a message '${s}'`,r),this.#d.dispatch(s,r)}catch(e){B(`'${this.#h.name}' error handling message`,e)}};once=this.#d.once;on=this.#d.on;off=this.#d.off;#p=(e,t)=>JSON.stringify({ns:this.#h.namespace,event:e,params:t});emit=(e,t)=>{this.#h.target.postMessage(this.#p(e,t),"*"),B(`'${this.#h.name}' sent message '${String(e)}'`,t)}}const{debug:L,error:R}=M.tag("sf:host:intersection"),U=e=>f(e)&&(e=>f(e)&&g(e.t)&&g(e.l)&&g(e.r)&&g(e.b)&&g(e.xiv)&&g(e.yiv)&&g(e.iv)&&g(e.z)&&g(e.w)&&g(e.h))(e.self)&&(e=>f(e)&&g(e.t)&&g(e.b)&&g(e.l)&&g(e.r)&&g(e.w)&&g(e.h))(e.win)&&(e=>f(e)&&g(e.t)&&g(e.l)&&g(e.r)&&g(e.b)&&(g(e.xs)||u(e.xs))&&(g(e.ys)||u(e.ys)))(e.exp),J={register:e=>f(e)&&g(e.w)&&g(e.h),updateGeom:e=>f(e)&&u(e.hasFocus)&&U(e.geom)},{debug:V,error:G}=M.tag("safeframe:ext"),z={"exp-ovr":!1,"exp-push":!1,"read-cookie":!1,"write-cookie":!1};class W{#m;constructor(e){const t=`safeframe:ext:${e.name}`,s=new H({name:t,namespace:"hbv:sf:v1",validators:J,target:top});this.#m={id:t,channel:s,registrations:[],hasFocus:e.hasFocus,status:"expanded",geom:e.geom,features:{...z}},s.on("updateGeom",(e=>{V("geom updated",e),this.#m.hasFocus=e.hasFocus,this.#m.geom=e.geom,this.#f("geom-update",{cmd:"register",reason:"geom-update",info:{hasFocus:e.hasFocus,geom:e.geom}})}))}#f=(e,t)=>{for(const s of this.#m.registrations)try{s(e,t)}catch(e){G("error notifying registration callback",e)}};supports=e=>{const t=this.#m.features;return p(e)?t[e]??!1:{...t}};register=(e,t,s)=>{if(V(`'${this.#m.id}' register`,e,t,s),!g(e)||!g(t))return G("$sf.ext.register expects (initWidth: number, initHeight: number, cb?: Function) arguments");m(s)&&this.#m.registrations.push(s),this.#m.channel.emit("register",{w:e,h:t})};geom=()=>this.#m.geom;inViewPercentage=()=>{const e=this.#m.geom.self.iv;return Math.round(100*e)};expand=()=>{G("'expand' is not supported yet")};collapse=()=>{G("'collapse' is not supported yet")};status=()=>this.#m.status;meta=()=>{G("'meta' is not supported yet")};cookie=()=>{G("'cookie' is not supported yet")};winHasFocus=()=>this.#m.hasFocus}const q={error:e=>f(e)&&g(e.code)&&p(e.message),ready:e=>f(e)&&p(e.placementId),render:e=>f(e)&&(e=>f(e)&&g(e.cpm)&&(p(e.adMarkup)||p(e.adUrl))&&p(e.bidId)&&g(e.width)&&g(e.height)&&(e=>f(e)&&p(e.bidder)&&p(e.creativeId)&&p(e.placementId))(e))(e.bid)&&(e=>f(e)&&p(e.url)&&p(e.domain))(e.metadata)&&f(e.safeFrame)&&u(e.safeFrame.hasFocus)&&U(e.safeFrame.geom)},{debug:K}=M.tag("sandbox:client");(()=>{const e=d.pid;K(`loaded for placementId '${e}'`);const t=new H({name:`sandbox:child:${e}`,namespace:"hbv:sandbox",validators:q,target:top});e?(t.on("render",(t=>((e,t)=>{const s={ext:new W({name:e,hasFocus:t.safeFrame.hasFocus,geom:t.safeFrame.geom})};window.$sf=s,window.HbvSandbox={url:t.metadata.url,domain:t.metadata.domain},(async(e,t)=>{const{bid:s,creativeType:r}=t,o=C.value?.findPrebidRenderer(s.bidId);if(o)o();else if(s.adMarkup){const r=t.useInnerFrame?await P(e,s):e;r.open(),t.afterDocumentOpen?.(r),r.write(s.adMarkup),r.close()}else if(s.adUrl)try{await P(e,s,s.adUrl)}catch{}else N("there was an error displaying a bid",s);((e,t,s)=>{const r=()=>{e.body.insertBefore(((e,t,s)=>e.createComment(` Hubvisor: '${s.creativeType}' creative #${t.creativeId} from '${t.bidder}' for placement '${t.placementId}' `))(e,t,s),e.body.firstChild)};e.body?r():e.addEventListener("DOMContentLoaded",r)})(e,s,{creativeType:r})})(document,{bid:t.bid,creativeType:"sandbox-banner",useInnerFrame:!0,afterDocumentOpen:e=>{e.defaultView&&(e.defaultView.$sf=s)}})})(e,t))),t.emit("ready",{placementId:e})):t.emit("error",{code:1016,message:"no placement identifier found for sandbox client"})})();